---
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: robopd2-api-runner
  namespace: actions-runner-system
spec:
  replicas: 1
  template:
    spec:
      repository: cameronrosier/robopd2-api
      labels:
        - self-hosted
        - robopd2
      
      image: summerwind/actions-runner-dind:latest
      
      # Enable Docker-in-Docker
      dockerEnabled: true
      dockerdWithinRunnerContainer: true
      
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: 1000m
          memory: 2Gi
      
      # Volumes for Docker storage
      volumeMounts:
        - name: work
          mountPath: /runner/_work
        - name: docker-storage
          mountPath: /var/lib/docker
      
      volumes:
        - name: work
          emptyDir: {}
        - name: docker-storage
          emptyDir: {}
      
      # Note: nodeSelector removed - control-plane node has taint that prevents scheduling
      # Worker nodes don't have node-role.kubernetes.io/control-plane label